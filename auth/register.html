<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>åˆå›åˆ©ç”¨è€…ç™»éŒ² | PoCKet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body class="page-transition fade-in">

<div id="header-wrapper">
  <header id="main-header">
    <div class="header-content">
      <a href="../index.html">
        <img src="../assets/images/club-icon.JPG" alt="ãƒ­ã‚´" class="logo">
        <div class="site-title">
          <h1>PoCKet åˆ©ç”¨è€…ç™»éŒ²</h1>
          <p>Photo Club Koganei Equipment Terminal</p>
        </div>
      </a>
    </div>
  </header>

  <nav class="navbar">
    <ul>
      <li><a href="./login.html">ãƒ­ã‚°ã‚¤ãƒ³</a></li>
      <li><a href="#" class="disabled">åˆå›ç™»éŒ²</a></li>
    </ul>
  </nav>
</div>

<main>
  <section class="camera-center-section">
    <h2>åˆå›åˆ©ç”¨è€…ç™»éŒ²</h2>

    <div class="camera-description">
      <p id="reg-email" style="font-weight:bold;"></p>
      <p>ä»¥ä¸‹ã®æƒ…å ±ã¯ã€è²¸å‡ºç®¡ç†ã®ãŸã‚ã«éƒ¨å†…ã§ã®ã¿åˆ©ç”¨ã—ã¾ã™ã€‚</p>
    </div>

    <div class="c-section__container" style="max-width:420px; margin:0 auto;">
      <label>æ°åï¼ˆåå­—ã¨åå‰ã®é–“ã«åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚ï¼‰</label><br>
      <input id="reg-name" type="text" style="width:100%; padding:8px;"><br><br>

      <label>LINE è¡¨ç¤ºå</label><br>
      <input id="reg-line" type="text" style="width:100%; padding:8px;"><br><br>

      <label>å­¦å¹´</label><br>
      <select id="reg-grade" style="width:100%; padding:8px;">
        <option value="1">B1</option>
        <option value="2">B2</option>
        <option value="3">B3</option>
        <option value="4">B4</option>
        <option value="5">M1</option>
        <option value="6">M2</option>
      </select>
      <br><br>

      <!-- å½¹è·é¸æŠãªã—ï¼ˆç®¡ç†è€…ã‚’ç™»éŒ²å¾Œã«ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã™ã‚‹ï¼‰-->
      <!-- <label>å½¹è·</label><br>
      <select id="reg-role" style="width:100%; padding:8px;">
        <option value="0">å½¹è·ãªã—</option>
        <option value="1">éƒ¨é•·</option>
        <option value="2">å‰¯éƒ¨é•·</option>
        <option value="3">ä¼šè¨ˆ</option>
        <option value="4">æ–‡é€£</option>
      </select> -->
      <br><br>

      <button class="button" onclick="sendRegister()">ç™»éŒ²ã™ã‚‹</button>
    </div>
  </section>
</main>

<footer>
  <p>Â© å†™çœŸæŠ€è¡“ç ”ç©¶ä¼š PoCKet</p>
</footer>

<script>
const USER_API =
  "https://script.google.com/macros/s/AKfycbxWNWz8aIr_8DqTTHsk9y089ZLZO6B8m2ywd6e1kCWi6Fyhr4AIOcS5QwdXpHxjx8w/exec";

const email = sessionStorage.getItem("email");
document.getElementById("reg-email").textContent =
  email ? ("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹: " + email) : "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚";

async function sendRegister() {
  const email = sessionStorage.getItem("email"); // â† å–å¾—ã—å¿˜ã‚Œå¯¾å¿œ

  const payload = {
    mode: "register",
    email,
    name: document.getElementById("reg-name").value.trim(),
    lineName: document.getElementById("reg-line").value.trim(),
    grade: document.getElementById("reg-grade").value,
    role: 0   // â˜…è‡ªå‹•ã§å½¹è·ãªã—
    // role: document.getElementById("reg-role").value
    // â†‘å½¹è·ãªã—å¯¾å¿œ(ç®¡ç†è€…ç™»éŒ²å¾Œã«ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ)
  };

  if (!payload.email || !payload.name || !payload.lineName) {
    alert("âš ï¸ å…¥åŠ›é …ç›®ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚");
    return;
  }

  const res = await fetch(USER_API, {
    method: "POST",
    // Content-Typeã¯ä»˜ã‘ãªã„ï¼ï¼ˆCORSå¯¾ç­–ï¼‰
    body: JSON.stringify(payload)
  });

  const data = await res.json();

  if (data.result === "registered") {
    alert("ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼ğŸ‰ ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸æˆ»ã‚Šã¾ã™");
    sessionStorage.removeItem("email");
    window.location.href = "/reserve_site/auth/login.html";
  } else {
    alert("âš ï¸ ç™»éŒ²ã‚¨ãƒ©ãƒ¼: " + (data.message ?? "Unknown Error"));
  }
}
</script>
</body>
</html>
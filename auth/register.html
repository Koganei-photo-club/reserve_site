<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>åˆå›åˆ©ç”¨è€…ç™»éŒ² | PoCKet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="/assets/css/camera.css">
</head>
<body class="page-transition fade-in">

<div id="header-wrapper">
  <header id="main-header">
    <div class="header-content">
      <a href="/index.html">
        <img src="/assets/images/club-icon.JPG" alt="ãƒ­ã‚´" class="logo">
        <div class="site-title">
          <h1>PoCKet åˆ©ç”¨è€…ç™»éŒ²</h1>
          <p>Photo Club Koganei Equipment Terminal</p>
        </div>
      </a>
    </div>
  </header>

  <nav class="navbar">
    <ul>
      <li><a href="/index.html">ãƒ­ã‚°ã‚¤ãƒ³</a></li>
      <li><a href="#" class="disabled">åˆå›ç™»éŒ²</a></li>
    </ul>
  </nav>
</div>

<main>
  <section class="camera-center-section">
    <h2>åˆå›åˆ©ç”¨è€…ç™»éŒ²</h2>

    <div class="camera-description">
      <p id="reg-email" style="font-weight:bold;"></p>
      <p>ä»¥ä¸‹ã®æƒ…å ±ã¯ã€è²¸å‡ºç®¡ç†ã®ãŸã‚ã«éƒ¨å†…ã§ã®ã¿åˆ©ç”¨ã—ã¾ã™ã€‚</p>
    </div>

    <div class="c-section__container" style="max-width:420px; margin:0 auto;">
      <label>æ°å</label><br>
      <input id="reg-name" type="text" style="width:100%; padding:8px;"><br><br>

      <label>LINE è¡¨ç¤ºå</label><br>
      <input id="reg-line" type="text" style="width:100%; padding:8px;"><br><br>

      <label>å­¦å¹´</label><br>
      <select id="reg-grade" style="width:100%; padding:8px;">
        <option value="1">B1</option>
        <option value="2">B2</option>
        <option value="3">B3</option>
        <option value="4">B4</option>
        <option value="5">M1</option>
        <option value="6">M2</option>
      </select>
      <br><br>

      <button class="button" onclick="sendRegister()">ç™»éŒ²ã™ã‚‹</button>
    </div>
  </section>
</main>

<footer>
  <p>Â© å†™çœŸæŠ€è¡“ç ”ç©¶ä¼š PoCKet</p>
</footer>

<script>
const USER_API =
  "https://script.google.com/macros/s/AKfycbzoovwcdLn6EU_CuqOUak2s9GqSfPUFBKGYfDbp_ZdAmQNzJyJDE2yHzKTSgTULV6Ip/exec";

const email = sessionStorage.getItem("email");
document.getElementById("reg-email").textContent =
  email ? ("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹: " + email) : "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚";

async function sendRegister() {
  const payload = {
    mode: "register",
    email: email,
    name: document.getElementById("reg-name").value.trim(),
    lineName: document.getElementById("reg-line").value.trim(),
    grade: document.getElementById("reg-grade").value
  };

  if (!payload.email || !payload.name || !payload.lineName) {
    alert("æ°åãƒ»LINEè¡¨ç¤ºåãŒæœªå…¥åŠ›ã§ã™ã€‚");
    return;
  }

  await fetch(USER_API, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(payload)
  });

  alert("ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼ğŸ‰ ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚Šã¾ã™ã€‚");
  sessionStorage.removeItem("email");
  window.location.href = "/index.html";
}
</script>
</body>
</html>